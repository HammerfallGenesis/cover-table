/*****************************************************************
 * src/features/gantt/palette.ts â€“ auto-generated from legacy Cover-Table v2025-05
 *   â€¢ ì „ì²´ ì´ê´€ ì½”ë“œ â€“ ìˆ˜ì • ê¸ˆì§€
 *****************************************************************/

/* ===============================================================
 *  Gantt  âœ  Palette Module
 * ---------------------------------------------------------------
 *  Â· ê°„íŠ¸ ì°¨íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” **ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ê´€ë¦¬ ì „ìš©** ëª¨ë“ˆì…ë‹ˆë‹¤.
 *  Â· ê¸°ì¡´ GanttTable.ts ì— ë¶„ì‚°ë¼ ìˆë˜ ìƒ‰ìƒ ìƒìˆ˜â€§í• ë‹¹ ë¡œì§ì„
 *    ì¬ì‚¬ìš©ì„±ì´ ë†’ë„ë¡ ë³„ë„ íŒŒì¼ë¡œ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.
 *
 *  ğŸ“Œ ì£¼ìš” êµ¬ì„±
 *    1) ê¸°ë³¸ íŒ”ë ˆíŠ¸ ìƒìˆ˜       â€“  DEFAULT_DARK / DEFAULT_LIGHT
 *    2) pickPalette()          â€“  í…Œë§ˆ(ë¼ì´íŠ¸/ë‹¤í¬) + ì‚¬ìš©ì ì„¤ì •
 *    3) GanttPalette class     â€“  ë…¸íŠ¸ ì œëª© â†” ìƒ‰ìƒ ë§¤í•‘ í—¬í¼
 * =============================================================== */

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1.  ê¸°ë³¸ íŒ”ë ˆíŠ¸ ìƒìˆ˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
/** ë‹¤í¬ í…Œë§ˆ ê¸°ë³¸ íŒ”ë ˆíŠ¸ */
export const DEFAULT_DARK: string[] = [
  "#ff6363", "#ffa600", "#ffcf00", "#8aff80", "#2effd3",
  "#00ffff", "#25c6fc", "#3399ff", "#9975e2", "#cc66cc",
  "#ff66ff", "#ff66cc", "#ff6699", "#ff6666", "#f06b60",
  "#ed7732", "#de9f00", "#afff68", "#53ffb4", "#2f9eff",
];

/** ë¼ì´íŠ¸ í…Œë§ˆ ê¸°ë³¸ íŒ”ë ˆíŠ¸ */
export const DEFAULT_LIGHT: string[] = [
  "#ff9999", "#ffc04d", "#ffe680", "#b3ffb3", "#80fff2",
  "#80ffff", "#99daff", "#99c2ff", "#c2a3e8", "#df9edf",
  "#ff99ff", "#ff99e6", "#ff99c2", "#ff9999", "#f4a38c",
  "#f1b066", "#eec900", "#c5ff8a", "#84ffc9", "#74baff",
];

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  2.  pickPalette()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Â· ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ + ì‚¬ìš©ì ì •ì˜ íŒ”ë ˆíŠ¸ ì„¤ì •ì„ ì¡°í•©í•˜ì—¬
    ìµœì¢… íŒ”ë ˆíŠ¸(string[])ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
export interface PaletteSettings {
  /** ë¼ì´íŠ¸/ë‹¤í¬ ê³µí†µ íŒ”ë ˆíŠ¸(ìš°ì„ ìˆœìœ„ 2) */
  colorPalette?: string[];
  /** ë‹¤í¬ ëª¨ë“œ ì „ìš© ì‚¬ìš©ì íŒ”ë ˆíŠ¸(ìš°ì„ ìˆœìœ„ 1) */
  colorPaletteDark?: string[];
  /** ë¼ì´íŠ¸ ëª¨ë“œ ì „ìš© ì‚¬ìš©ì íŒ”ë ˆíŠ¸(ìš°ì„ ìˆœìœ„ 1) */
  colorPaletteLight?: string[];
}

/**
 * @param isDark   í˜„ì¬ Obsidian í…Œë§ˆê°€ ë‹¤í¬ì¸ì§€ ì—¬ë¶€
 * @param opts     GanttSettings ì¼ë¶€(colorPalette ê´€ë ¨) êµ¬ì¡°ì²´
 * @returns        ìµœì¢… ìƒ‰ìƒ ë°°ì—´(ë°©ì–´ì  ë³µì‚¬ë³¸)
 */
export function pickPalette(
  isDark: boolean,
  opts: PaletteSettings = {},
): string[] {
  const { colorPalette, colorPaletteDark, colorPaletteLight } = opts;

  /* ë‹¤í¬ ëª¨ë“œ */
  if (isDark) {
    return (
      colorPaletteDark ??
      colorPalette ??
      DEFAULT_DARK
    ).slice();
  }

  /* ë¼ì´íŠ¸ ëª¨ë“œ */
  return (
    colorPaletteLight ??
    colorPalette ??
    DEFAULT_LIGHT
  ).slice();
}

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  3.  GanttPalette í´ë˜ìŠ¤
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Â· ë…¸íŠ¸(ë˜ëŠ” Task) ì´ë¦„ì„ íŒ”ë ˆíŠ¸ ìƒ‰ìƒì— ìˆœì°¨ì ìœ¼ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤.
  Â· ë™ì¼ ì´ë¦„ì€ í•­ìƒ ë™ì¼ ìƒ‰ìƒì´ ë°˜í™˜ë˜ë¯€ë¡œ ë²”ë¡€(legend)ì—
    í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
export class GanttPalette {
  private readonly noteColorMap: Record<string, { colorIndex: number | null }> = {};
  private colorPtr = 0;

  constructor(private readonly palette: string[]) {}

  /** ë…¸íŠ¸ ì´ë¦„ì„ íŒ”ë ˆíŠ¸ì— ë“±ë¡(ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì‹œ) */
  assign(note: string): void {
    if (this.noteColorMap[note]) return;
    if (this.palette.length === 0) {
      this.noteColorMap[note] = { colorIndex: null };
      return;
    }
    const idx = this.colorPtr % this.palette.length;
    this.noteColorMap[note] = { colorIndex: idx };
    this.colorPtr++;
  }

  /** ë“±ë¡ëœ ë…¸íŠ¸ ì´ë¦„ì˜ ìƒ‰ìƒì„ ë°˜í™˜(ì—†ìœ¼ë©´ ê¸°ë³¸ #999) */
  colorOf(note: string): string {
    const entry = this.noteColorMap[note];
    if (!entry || entry.colorIndex == null) return "#999";
    return this.palette[entry.colorIndex];
  }

  /** í˜„ì¬ ë§¤í•‘ ì •ë³´ë¥¼ ê°ì²´ í˜•íƒœ({ note: hex })ë¡œ ë°˜í™˜ */
  legend(): Record<string, string> {
    const res: Record<string, string> = {};
    Object.keys(this.noteColorMap).forEach(note => {
      res[note] = this.colorOf(note);
    });
    return res;
  }

  /** ì „ì²´ ë§¤í•‘â€§ìƒ‰ìƒ í¬ì¸í„° ì´ˆê¸°í™” */
  reset(): void {
    this.colorPtr = 0;
    Object.keys(this.noteColorMap).forEach(k => delete this.noteColorMap[k]);
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì°¸ê³  ì›ë³¸ ì½”ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * Â· ê¸°ë³¸ íŒ”ë ˆíŠ¸ ë°°ì—´ê³¼ ìƒ‰ìƒ í• ë‹¹ ë¡œì§ì€ legacy GanttTable.ts
 *   ì—ì„œ 1:1 í¬íŒ…í•˜ì˜€ìŠµë‹ˆë‹¤. :contentReference[oaicite:0]{index=0}:contentReference[oaicite:1]{index=1}
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
